<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="refresh" content="60">
    <title>DEX Bot Dashboard</title>
    <style>
        body {
            background: #0d1117;
            color: #e6edf3;
            font-family: Arial;
            padding: 20px;
        }
        .card {
            background: #161b22;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        table {
            width: 100%;
        }
        th, td {
            padding: 6px;
            text-align: left;
        }
        .green { color: #3fb950; }
        .red { color: #f85149; }
    </style>
    <!-- Chart.js and adapter -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3"></script>
</head>
<body>

<h2>ðŸ“Š Polygon Uniswap Bot</h2>

<div id="log-container" style="background:#000; color:#0f0; padding:15px; font-family:monospace; height:100px; overflow-y:auto; border-radius:5px; font-size: 0.85rem;">
</div>

<script>
function fetchLogs() {
    fetch('/dashboard/logs')
        .then(r => r.json())
        .then(data => {
            const container = document.getElementById('log-container');
            container.innerHTML = data.logs.map(l => `<div>${l}</div>`).join('');
        });
}
setInterval(fetchLogs, 5000);
fetchLogs();
</script>

<div class="card">
  <h3>ðŸ“ˆ Portfolio Growth</h3>
  <canvas id="portfolioChart"></canvas>
</div>

<script>
async function loadPortfolioChart() {
    const res = await fetch("/api/portfolio/history");
    const data = await res.json();

    // Convert to Chart.js format
    const chartData = data.map(d => ({
        x: new Date(d.time),  // ISO string -> Date
        y: d.equity
    }));

    const ctx = document.getElementById("portfolioChart").getContext("2d");

    if (window.portfolioChart) {
        window.portfolioChart.data.datasets[0].data = chartData;
        window.portfolioChart.update();
        return;
    }

    window.portfolioChart = new Chart(ctx, {
        type: 'line',
        data: {
            datasets: [{
                label: 'Portfolio Equity',
                data: chartData,
                borderColor: '#3fb950',
                backgroundColor: 'rgba(63,185,80,0.2)',
                fill: true,
                tension: 0.35,
                pointRadius: 3,
                pointBackgroundColor: '#3fb950'
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: {
                x: {
                    type: 'time',
                    time: {
                        tooltipFormat: 'MMM d, yyyy HH:mm:ss',
                        displayFormats: { minute: 'HH:mm', hour: 'HH:mm', day: 'MMM dd' }
                    },
                    title: { display: true, text: 'Time' },
                    ticks: { color: '#e6edf3' }
                },
                y: {
                    beginAtZero: false,
                    title: { display: true, text: 'Equity ($)' },
                    ticks: { color: '#e6edf3' }
                }
            }
        }
    });
}

loadPortfolioChart();
setInterval(loadPortfolioChart, 120000);
</script>

</body>
</html>
